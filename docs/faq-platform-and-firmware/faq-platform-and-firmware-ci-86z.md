# CI-86Z 平台与固件 FAQ

本页用于整理 CI-86Z 相关的平台配置与固件问题。

### CI-86Z系列芯片内存版本如何区分？

**问题描述：**

CI-86Z系列芯片有1M和2M两种内存版本，需要准确区分以避免使用错误的固件。

**区分方法：**

1. **型号识别**：

    - CI-86Z1：1M Flash版本
    - CI-86Z2：2M Flash版本

2. **固件兼容性**：

    - 1M版本固件无法在2M版本上使用
    - 2M版本固件向下兼容1M硬件（但功能受限）
    - 选择固件时必须与硬件版本匹配

3. **选型建议**：

    - 功能简单：选择1M版本
    - 需要更多存储空间：选择2M版本
    - 不确定时选择2M版本以预留扩展空间

---

### 多MCU与语音模块通信时数据冲突如何解决？

**问题描述：**

多个MCU同时向语音模块发送串口数据时，导致数据混合、错乱，影响小程序界面显示和语音功能正常使用。

**问题现象：**

1. **数据混合**：两个MCU同时发送数据（如11 22 33），会混合成11 44 66 33等错误数据
2. **界面错乱**：小程序接收到错误数据后显示错误的功能界面
3. **语音失效**：由于数据错误，语音控制功能无法正常工作
4. **识别错误**：模块将错误的命令识别为其他功能指令

**技术原因分析：**

1. **串口冲突**：

    - 多个MCU共享同一个串口向模块发送数据
    - 没有做好数据同步机制
    - 数据发送时机重叠导致字节级交错

2. **协议重复**：

    - 不同功能的回复数据使用相同的协议头（如82 01）
    - 查询回复与操作指令数据格式冲突
    - 缺乏有效的数据校验机制

**解决方案：**

1. **硬件连接优化**：

    **级联连接方案**：
    ```
    MCU1 ←→ MCU2 ←→ 语音模块
    ```
    - MCU1与MCU2相连
    - MCU2负责转发MCU1的数据
    - 语音模块仅连接MCU2
    - 实现数据的统一管理和转发

2. **协议设计优化**：

    **区分数据类型**：

    - 使用不同的协议头区分不同功能
    - 查询回复：82 0B XX XX XX
    - 操作指令：82 01 XX XX XX
    - 确保每类数据有唯一标识

    **添加数据校验**：

    - 在数据包中添加校验和
    - 使用帧头帧尾标记数据边界
    - 实现数据完整性验证

3. **软件时序控制**：

    **数据发送同步**：

    - MCU之间建立握手机制
    - 确保同一时间只有一个MCU发送数据
    - 使用忙信号线防止数据冲突

    **缓冲队列管理**：

    - 为每个MCU建立独立的数据缓冲区
    - 采用轮询或优先级机制处理数据
    - 避免数据丢失或延迟

**实施建议：**

1. **设计阶段**：

    - 提前规划数据通信协议
    - 设计防冲突机制
    - 预留扩展空间

2. **开发阶段**：

    - 实现数据发送的互斥控制
    - 添加调试日志便于问题排查
    - 进行充分的压力测试

3. **测试验证**：

    - 模拟各种并发场景
    - 验证数据完整性
    - 确保系统稳定性

**注意事项：**

- 修改协议需要同时更新相关的语音指令配置
- 生产前需要进行充分的兼容性测试
- 考虑未来功能扩展对通信协议的影响
- 建议使用标准的通信框架简化开发

---

### CI-86Z被动播报模式如何配置？

**问题描述：**

需要将语音模块从主动播报模式改为被动播报模式，即根据MCU返回的数据来决定是否播报及播报内容。

**配置方案：**

1. **主动播报vs被动播报**：

    **主动播报**：

    - 模块识别到命令后立即播报
    - 不依赖MCU返回数据
    - 响应速度快，但灵活性差

    **被动播报**：

    - 模块发送控制数据给MCU
    - 根据MCU返回数据决定播报内容
    - 灵活性高，便于后期维护

2. **配置方法**：

    **删除命令词主动播报**：

    - 在平台配置中取消命令词的主动播报
    - 保留串口发送功能
    - 设置被动播报触发条件

    **设置被动播报规则**：

    - 定义MCU返回数据格式
    - 配置数据与播报内容的映射关系
    - 设置超时处理机制

3. **优化建议**：

    **性能考虑**：

    - 被动播报会增加系统负载
    - 需要重写串口中断处理程序
    - 评估当前系统负载是否可承受

    **兼容性处理**：

    - 音乐播放等功能可能仍需主动播报
    - 混合模式：部分功能主动，部分功能被动
    - 儿童锁等特殊状态的处理

**注意事项：**

- 被动播报需要MCU配合开发
- 修改涉及面较大，建议在项目初期确定方案
- 充分测试各种边界情况

---

### CI-86Z支持蓝牙串口透传功能吗？

**问题描述：**

用户需要实现通过手机蓝牙发送信息，然后通过串口转发给单片机的功能，询问CI-86Z是否支持蓝牙串口透传。

**解决方案：**

**CI-86Z和SU-63T支持蓝牙串口透传功能，但需要定制开发：**

- **功能支持**：CI-86Z和SU-63T模块可以实现蓝牙串口透传功能
- **开发方式**：此功能属于定制开发需求，需要通过项目方式实现
- **数据流向**：手机蓝牙 → 模块 → 串口(UART) → 单片机

**定制开发流程：**

1. **需求确认**
    - 提供详细的功能需求说明
    - 明确通信协议（如Modbus等）
    - 说明数据量和实时性要求

2. **方案评估**
    - 填写产品项目需求收集表
    - 技术研发团队评估工作量
    - 确认开发周期和费用

3. **开发实施**
    - 研发团队进行定制开发
    - 提供测试固件验证功能
    - 完成后交付正式版本

**应用场景：**

- 手机APP控制设备
- 蓝牙数据采集与转发
- 设备参数配置与监控
- 支持Modbus等工业通信协议

**注意事项：**

- 蓝牙串口透传功能不属于平台标准配置
- 需要评估具体需求后进行定制开发
- 建议在产品设计早期确定功能需求
- 如项目需求明确，可联系技术支持获取详细方案

---
### CI-86Z蓝牙配对时间如何设定？

**问题描述：**

模块上电后蓝牙配对功能持续多长时间，是否可以设定固定时间后自动关闭配对。

**配对时间说明：**

**1. 默认配对时间**

- **配对窗口**：设备上电后5分钟内可进行蓝牙配对
- **自动关闭**：5分钟后配对功能自动关闭，防止他人随意连接
- **重新触发**：重新上电后可再次进入配对模式

**2. 语音开启配对模式**

- **功能支持**：可通过语音指令进入配对模式
- **指令示例**："进入配对模式"
- **配对时间**：语音触发后同样开启5分钟配对窗口
- **播报提示**：进入配对模式后会播报提示信息

**3. 应用场景**

- **上电配对**：适用于首次使用或更换遥控器的场景
- **语音配对**：适用于需要更换遥控器但不想断电重启的场景
- **安全考虑**：5分钟自动关闭避免长期暴露配对风险

**注意事项：**

- 配对模式下，小程序和蓝牙遥控器均可进行配对
- 5分钟时间从上电或语音触发时刻开始计算
- 配对成功后，配对功能保持激活状态
- 无需"退出配对模式"语音指令，5分钟自动关闭

---

### CI-86Z遥控器M值默认设置是多少？

**问题描述：**

使用遥控器控制时，M值的默认设置是多少，如何修改默认模式。

**M值说明：**

**1. 默认M值**

- **出厂默认**：M = 0
- **功能含义**：默认功能模式
- **应用场景**：基础版本的遥控器控制功能

**2. M值与功能对应**

```
M值 功能对应表：
0 - 默认功能（基础模式）
1 - 基础版本（仅3键）
2 - 带记忆位置
3 - 带记忆位置+灯控
4 - 带灯控
5-7 - 保留或自定义
```

**3. 修改M值**

- **修改方式**：需要通过固件配置修改默认M值
- **掉电保存**：M值支持断电后保存
- **动态切换**：运行时可修改M值切换功能模式

**注意事项：**

- 更换遥控器时如方向反了，需要检查M值设置
- M值的位数限制为4位（bit），数值范围0-7
- 设计时需预留M值空间便于功能扩展

---

### 如何将CI-86Z芯片直接整合到PCB板上？

**问题描述：**

产品空间受限，无法使用成品模块，希望将CI-86Z芯片直接整合到自设计的PCB板上。

**解决方案：**

**1. 获取芯片资料**

- **芯片规格书**：包含芯片引脚定义、电气参数
- **参考原理图**：官方提供参考电路设计
- **封装文件**：芯片PCB封装尺寸图

**2. 设计流程**

**第一步：获取参考原理图**
- 从芯片规格书中获取官方参考原理图
- 理解电源、时钟、复位等关键电路设计

**第二步：设计外围电路**
- 按照参考原理图设计电源电路
- 设计麦克风、喇叭、串口等接口电路
- 预留调试测试点

**第三步：PCB Layout**
- 参考官方PCB布局建议
- 注意天线区域保持净空
- 电源走线加粗，减少阻抗

**3. 天线匹配**

- **板子设计完成后**：建议将PCB板寄回进行天线匹配
- **匹配原因**：不同PCB布局会影响天线性能
- **匹配内容**：调试天线参数确保最佳性能

**4. 注意事项**

- **紧凑空间**：空间紧张时需要特别注意电源和信号布局
- **电源干扰**：电源与模块整合在同一板时，可能产生干扰
- **开机噪音**：如出现开机噪音，需要优化电源滤波和启动时序

**设计建议：**

- 预留足够测试点便于调试
- 参考官方推荐的PCB布局
- 电源部分建议独立LDO供电
- 完成设计后建议寄样进行天线匹配测试

---
